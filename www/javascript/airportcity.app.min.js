var mapzen=mapzen||{};mapzen.whosonfirst=mapzen.whosonfirst||{};mapzen.whosonfirst.log=(function(){var b=[];var a={show:function(){a.toggle(true)},hide:function(){a.toggle(false)},toggle:function(d){var f=document.getElementById("wof-log-container");if(!f){return false}var e=(d)?"display:block":"display:none";f.style=e},debug:function(c){a.log(c,"debug")},info:function(c){a.log(c,"info")},warning:function(c){a.log(c,"warning")},error:function(c){a.log(c,"error")},log:function(f,c){var e=new Date();b.push([c,f,e]);var d=a._render(f,c,e);a._attach(d)},_render:function(f,l,d){var g=mapzen.whosonfirst.php.htmlspecialchars(f);var e=mapzen.whosonfirst.php.htmlspecialchars(l);var k=document.createElement("li");k.setAttribute("class","wof-log-item wof-log-"+e);var j=document.createTextNode(" "+g);var i=document.createElement("span");i.setAttribute("class","wof-log-body");i.appendChild(j);var h=d.toISOString();h=mapzen.whosonfirst.php.htmlspecialchars(h);h=document.createTextNode(h+" "+l);var c=document.createElement("code");c.setAttribute("class","wof-log-ts");c.appendChild(h);k.appendChild(c);k.appendChild(i);return k},_attach:function(c){var d=document.getElementById("wof-log");if(!d){console.log("faile to locate #wof-log container");return false}d.insertBefore(c,d.childNodes[0]);return true}};return a})();var mapzen=mapzen||{};mapzen.whosonfirst=mapzen.whosonfirst||{};mapzen.whosonfirst.net=(function(){var b={};var a={encode_query:function(e){enc=new Array();for(var d in e){var c=e[d];c=encodeURIComponent(c);enc.push(d+"="+c)}return enc.join("&")},fetch:function(c,h,f){mapzen.whosonfirst.log.debug("fetch "+c);if(b[c]){mapzen.whosonfirst.log.debug("return "+c+" from cache");if(h){h(b[c])}return}var d=new XMLHttpRequest();d.onload=function(){try{var i=JSON.parse(this.responseText)}catch(j){mapzen.whosonfirst.log.error("failed to parse "+c+", because "+j);if(f){f()}return false}b[c]=i;if(h){h(i)}};try{d.open("get",c,true);d.send()}catch(g){mapzen.whosonfirst.log.error("failed to fetch "+c+", because ");mapzen.whosonfirst.log.debug(g);if(f){f()}}}};return a})();var mapzen=mapzen||{};mapzen.whosonfirst=mapzen.whosonfirst||{};mapzen.whosonfirst.php=(function(){var a={htmlspecialchars:function(d,j,h,c){var f=0,e=0,g=false;if(typeof j==="undefined"||j===null){j=2}d=d.toString();if(c!==false){d=d.replace(/&/g,"&amp;")}d=d.replace(/</g,"&lt;").replace(/>/g,"&gt;");var b={ENT_NOQUOTES:0,ENT_HTML_QUOTE_SINGLE:1,ENT_HTML_QUOTE_DOUBLE:2,ENT_COMPAT:2,ENT_QUOTES:3,ENT_IGNORE:4};if(j===0){g=true}if(typeof j!=="number"){j=[].concat(j);for(e=0;e<j.length;e++){if(b[j[e]]===0){g=true}else{if(b[j[e]]){f=f|b[j[e]]}}}j=f}if(j&b.ENT_HTML_QUOTE_SINGLE){d=d.replace(/'/g,"&#039;")}if(!g){d=d.replace(/"/g,"&quot;")}return d}};return a})();var mapzen=mapzen||{};mapzen.whosonfirst=mapzen.whosonfirst||{};mapzen.whosonfirst.airportcity=(function(){var h=3;var l=16;var a="ffffff";var f="72a0c1";var c=parseInt(a.substring(0,2),16);var i=parseInt(a.substring(2,4),16);var k=parseInt(a.substring(4,6),16);var e=parseInt(f.substring(0,2),16);var j=parseInt(f.substring(2,4),16);var o=parseInt(f.substring(4,6),16);var b;var g;var d;var n="http://localhost:3333";var m={init:function(){var p={minZoom:h,maxZoom:l};b=L.map("map",p);L.hash(b);g=Tangram.leafletLayer({scene:"tangram/airportcity.yaml",numWorkers:2,unloadInvisibleTiles:false,updateWhenIdle:false,attribution:'<a href="https://mapzen.com/tangram" target="_blank">Tangram</a> | &copy; OSM contributors | <a href="https://mapzen.com/" target="_blank">Mapzen</a>'});g.addTo(b);b.setView([40.6856,-74.1654],13);b.on("zoomend",m.onzoom);m.onzoom();var r=document.getElementById("feedback-controls");r.onclick=m.hide_feedback;document.body.onkeydown=m.onkeyboard;var q=document.getElementById("search");q.onclick=m.search;var r=document.getElementById("camera");r.onclick=m.screenshot_as_file},onkeyboard:function(q){var p=q.keyCode||q.which;var r=String.fromCharCode(p);if((q.shiftKey)&&(r=="S")){if(q.metaKey){m.screenshot_as_file()}else{m.screenshot()}}},onzoom:function(){function v(z,x,B,r){if(z<x){return((x-z)*(B/r))+z}return((z-x)*(1-(B/r)))+x}function t(z){var x="0123456789abcdef";var r=parseInt(z);if(r==0||isNaN(z)){return"00"}r=Math.round(Math.min(Math.max(0,r),255));return x.charAt((r-r%16)/16)+x.charAt(r%16)}var w=null;try{w=b.zoom()}catch(A){w=b.getZoom()}var q=Math.ceil((w.toFixed(1)-h)*10);var p=v(c,e,q,100);var u=v(i,j,q,100);var y=v(k,o,q,100);bgcolor=t(p)+t(u)+t(y);var s=document.getElementById("map");s.style.backgroundColor="#"+bgcolor},search:function(){var r=document.getElementById("search_query");r=r.value;if(r==""){alert("Silly! You forgot to say what you want to search for")}query=mapzen.whosonfirst.net.encode_query({q:r});url=m.search_endpoint()+"?"+query;var t=function(E){var A=E.length;if(A==0){var x="sorry, there don't appear to be any results for '"+r+"'";mapzen.whosonfirst.airportcity.feedback(x);return}else{if(A==1){var z=E[0];var C=z.Latitude;var v=z.Longitude;b.setView([C,v],13)}else{var B=undefined;var u=undefined;var D=undefined;var w=undefined;for(var y=0;y<A;y++){var C=E[y]["Latitude"];var v=E[y]["Longitude"];if((!B)||(C<B)){B=C}if((!u)||(v<u)){u=v}if((!D)||(C>D)){D=C}if((!w)||(v>w)){w=v}}var q=[[B,u],[D,w]];b.fitBounds(q);var x="mutiple results for '"+r+"' so zooming out to fit them all";mapzen.whosonfirst.airportcity.feedback(x)}}};var p=function(q){var u="oh no... there was a problem doing that search";mapzen.whosonfirst.airportcity.feedback(u)};try{mapzen.whosonfirst.net.fetch(url,t,p)}catch(s){console.log(s)}return false},search_endpoint:function(p){if(p){n=p}return n},toggle_footer:function(q){var r=(q)?"display:inline;":"display:none;";var s=document.getElementById("footer");s.style=r;var p=document.getElementsByClassName("leaflet-control-attribution");p[0].style=r},feedback:function(r){if(d){clearTimeout(d)}var p=document.getElementById("feedback-msg");p.innerHTML=mapzen.whosonfirst.php.htmlspecialchars(r);var q=document.getElementById("feedback");q.style="display:block;";d=setTimeout(function(){mapzen.whosonfirst.airportcity.hide_feedback()},5000)},hide_feedback:function(){var p=document.getElementById("feedback-msg");p.innerHTML="";var q=document.getElementById("feedback");q.style="display:none;"},scene:function(){return g.scene},screenshot_as_file:function(){var q="tangram-airportcity-"+(+new Date())+".png";var p=function(r){saveAs(r.blob,q)};m.screenshot(p)},screenshot:function(q){if(!q){q=function(t){window.open(t.url)}}var r=m.scene();var p=document.getElementById("map");var s=p.style.backgroundColor;if(!r.config.scene.background){r.config.scene.background={}}r.config.scene.background.color=s;r.updateConfig();r.screenshot().then(function(t){q(t);r.config.scene.background={};r.updateConfig()})}};return m})();